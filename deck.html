import React, { useMemo, useState, useEffect, useCallback } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { ArrowLeft, ArrowRight, Users, Briefcase, Play, ExternalLink, CheckCircle2, Shield, BarChart3, Link as LinkIcon, Rocket, HelpCircle, Clock, LayoutGrid, Sparkles, TrendingUp } from "lucide-react";

// ======== CONFIG GENERAL ========
const SITE_URL = "https://dylanmoralesv.github.io/EduConecta/";

const container = "max-w-[1100px] mx-auto p-4 sm:p-6 md:p-8";
const card = "rounded-2xl bg-white/5 border border-white/10 shadow-[0_10px_40px_rgba(0,0,0,0.25)] backdrop-blur";
const btn = "inline-flex items-center gap-2 px-4 py-2 rounded-full font-semibold transition active:scale-[.98] focus:outline-none focus:ring-2 focus:ring-sky-400";

const theme = {
  bg: "min-h-screen text-slate-100 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950",
  h1: "text-2xl sm:text-3xl md:text-4xl font-extrabold tracking-tight",
  h2: "text-xl sm:text-2xl md:text-3xl font-bold",
  p: "text-sm sm:text-base text-slate-300",
  kpi: "text-3xl sm:text-4xl font-black"
};

// ======== SLIDES (USUARIOS) ========
const userSlides = [
  {
    title: "Bienvenida",
    notes: "Presenta el objetivo: en 2 minutos puedes empezar a estudiar y pedir ayuda si lo necesitas.",
    content: (
      <div className="grid md:grid-cols-2 gap-4 md:gap-6">
        <div className={`${card} p-6`}>
          <h2 className={theme.h2}>EduConecta</h2>
          <p className={`${theme.p} mt-2`}>Una puerta de entrada <b>r√°pida</b> al estudio + bienestar. Micro‚Äëtareas de 5 minutos, mini‚Äëtest emocional y un bot√≥n de ayuda listo para usar.</p>
          <ul className="mt-4 space-y-2 text-slate-200">
            <li className="flex items-center gap-2"><CheckCircle2 className="text-emerald-400"/> Micro‚Äëtarea ‚ñ∂Ô∏è logro inmediato</li>
            <li className="flex items-center gap-2"><CheckCircle2 className="text-emerald-400"/> Mini‚Äëtest ‚ñ∂Ô∏è feedback simple</li>
            <li className="flex items-center gap-2"><CheckCircle2 className="text-emerald-400"/> Pide ayuda ‚ñ∂Ô∏è correo/WhatsApp prellenado</li>
          </ul>
        </div>
        <div className={`${card} p-6 flex flex-col items-center justify-center text-center`}>
          <Play className="w-12 h-12 text-sky-400"/>
          <p className="mt-3">Demo interactiva: sigue las flechas <kbd>‚Üê</kbd> <kbd>‚Üí</kbd> o usa los botones.</p>
          <a href={SITE_URL} target="_blank" rel="noreferrer" className={`${btn} mt-4 bg-sky-500/90 hover:bg-sky-500`}>Abrir prototipo <ExternalLink className="w-4 h-4"/></a>
        </div>
      </div>
    )
  },
  {
    title: "Problema (desde el aula)",
    notes: "Enfatiza fricci√≥n de arranque: no es solo ‚Äòno saber‚Äô, es ‚Äòno saber por d√≥nde partir‚Äô.",
    content: (
      <div className={`${card} p-6`}>
        <p className={theme.p}>Despu√©s de la pandemia persiste el rezago y cuesta <b>arrancar</b>: dudas, √°nimo variable y falta de una gu√≠a corta para empezar. EduConecta reduce esa fricci√≥n con una <b>ruta de 2 minutos</b>.</p>
        <div className="grid sm:grid-cols-3 gap-3 mt-4">
          <div className="p-4 rounded-xl bg-white/5 border border-white/10"><Clock className="text-amber-400"/><p className="mt-2">Tiempo a primer resultado &lt; 2 minutos</p></div>
          <div className="p-4 rounded-xl bg-white/5 border border-white/10"><HelpCircle className="text-pink-400"/><p className="mt-2">Ayuda accesible en un click</p></div>
          <div className="p-4 rounded-xl bg-white/5 border border-white/10"><Shield className="text-emerald-400"/><p className="mt-2">Privacidad por dise√±o (sin cuentas)</p></div>
        </div>
      </div>
    )
  },
  {
    title: "C√≥mo se usa (paso a paso)",
    notes: "Gu√≠a a la audiencia a replicar luego: Aprendo ‚Üí Me Siento ‚Üí Pide Ayuda ‚Üí Progreso.",
    content: (
      <div className="grid md:grid-cols-2 gap-4 md:gap-6">
        <div className={`${card} p-6`}>
          <ol className="list-decimal pl-5 space-y-2">
            <li>Elige una <b>micro‚Äëtarea</b> de 5‚Äô en <i>Aprendo</i>.</li>
            <li>Registra tu estado en <i>Me Siento</i> (√°nimo/estr√©s/energ√≠a).</li>
            <li>Si necesitas, usa <i>Pide Ayuda</i> (correo/WhatsApp prellenado).</li>
            <li>Revisa <i>Mi Progreso</i> para ver tu avance.</li>
          </ol>
        </div>
        <div className={`${card} p-6 text-center`}>
          <LayoutGrid className="w-10 h-10 mx-auto text-violet-400"/>
          <p className="mt-2">Consejo: parte por una tarea que domines para ganar confianza üí™</p>
          <a href={SITE_URL} target="_blank" rel="noreferrer" className={`${btn} mt-4 bg-violet-500/90 hover:bg-violet-500`}>Probar ahora <ExternalLink className="w-4 h-4"/></a>
        </div>
      </div>
    )
  },
  {
    title: "Progreso & Privacidad",
    notes: "Refuerza que los datos quedan en el dispositivo y se exportan solo si el estudiante quiere.",
    content: (
      <div className={`${card} p-6`}>
        <div className="grid sm:grid-cols-3 gap-3">
          <div className="p-4 rounded-xl bg-white/5 border border-white/10 text-center">
            <BarChart3 className="mx-auto text-sky-400"/>
            <p className="mt-2">Anal√≠tica local (micro‚Äëtareas, test)</p>
          </div>
          <div className="p-4 rounded-xl bg-white/5 border border-white/10 text-center">
            <Shield className="mx-auto text-emerald-400"/>
            <p className="mt-2">Sin PII ‚Ä¢ Exporta tu JSON</p>
          </div>
          <div className="p-4 rounded-xl bg-white/5 border border-white/10 text-center">
            <Sparkles className="mx-auto text-amber-400"/>
            <p className="mt-2">Motivaci√≥n: ‚ÄúMi espacio‚Äù personal</p>
          </div>
        </div>
      </div>
    )
  },
  {
    title: "Usa EduConecta en clase (10 minutos)",
    notes: "Cierra con CTA: QR/URL y pauta de 10‚Äô.",
    content: (
      <div className={`${card} p-6 flex flex-col items-center text-center`}>
        <p className={theme.p}>1) Abre el enlace ‚Ä¢ 2) Elige micro‚Äëtarea ‚Ä¢ 3) Registra tu estado ‚Ä¢ 4) Comparte c√≥mo te fue</p>
        <a href={SITE_URL} target="_blank" rel="noreferrer" className={`${btn} mt-4 bg-emerald-500/90 hover:bg-emerald-500`}><LinkIcon className="w-4 h-4"/> {SITE_URL}</a>
      </div>
    )
  }
];

// ======== SLIDES (INVERSORES) ========
const pilot = { n: 12, finish: 0.83, ttfb: 1.3, ui: 4.4, recall: 0.75, reuse: 4.2, errors: 0.3 };

const investorSlides = [
  {
    title: "Oportunidad",
    notes: "Exp√≥n el tama√±o y la urgencia: fricci√≥n de arranque, revinculaci√≥n, foco socioemocional.",
    content: (
      <div className={`${card} p-6 grid md:grid-cols-2 gap-4`}>
        <div>
          <h2 className={theme.h2}>Primera milla del estudio</h2>
          <p className={`${theme.p} mt-2`}>Aceleramos el inicio: en <b>2 minutos</b> el estudiante completa una micro‚Äëtarea, regula su estado y sabe d√≥nde pedir ayuda.</p>
          <ul className="mt-4 space-y-2">
            <li className="flex items-center gap-2"><TrendingUp className="text-emerald-400"/> Revinculaci√≥n y h√°bito</li>
            <li className="flex items-center gap-2"><Shield className="text-emerald-400"/> Privacidad por dise√±o</li>
            <li className="flex items-center gap-2"><Sparkles className="text-emerald-400"/> PWA liviana, sin cuentas</li>
          </ul>
        </div>
        <div className="grid sm:grid-cols-3 gap-3">
          <div className="p-4 rounded-xl bg-white/5 border border-white/10 text-center"><p className="uppercase text-xs text-slate-400">Tiempo 1er resultado</p><p className={theme.kpi}>{pilot.ttfb}<span className="text-base"> min</span></p></div>
          <div className="p-4 rounded-xl bg-white/5 border border-white/10 text-center"><p className="uppercase text-xs text-slate-400">Finalizaci√≥n</p><p className={theme.kpi}>{Math.round(pilot.finish*100)}<span className="text-base">%</span></p></div>
          <div className="p-4 rounded-xl bg-white/5 border border-white/10 text-center"><p className="uppercase text-xs text-slate-400">Claridad UI</p><p className={theme.kpi}>{pilot.ui}<span className="text-base">/5</span></p></div>
        </div>
      </div>
    )
  },
  {
    title: "Soluci√≥n y diferenciador",
    notes: "Resalta ‚Äòpuerta de entrada‚Äô: no compite con LMS, lo complementa.",
    content: (
      <div className={`${card} p-6`}>
        <ul className="grid sm:grid-cols-2 gap-3">
          <li className="p-4 rounded-xl bg-white/5 border border-white/10"><CheckCircle2 className="text-emerald-400"/> Micro‚Äëtareas 5‚Äô + mini‚Äëtest + ayuda</li>
          <li className="p-4 rounded-xl bg-white/5 border border-white/10"><CheckCircle2 className="text-emerald-400"/> Offline b√°sico (PWA) ‚Ä¢ sin PII</li>
          <li className="p-4 rounded-xl bg-white/5 border border-white/10"><CheckCircle2 className="text-emerald-400"/> Accesible (ARIA, teclado, contraste)</li>
          <li className="p-4 rounded-xl bg-white/5 border border-white/10"><CheckCircle2 className="text-emerald-400"/> Complementa LMS ‚Ä¢ Arranque de clase</li>
        </ul>
      </div>
    )
  },
  {
    title: "Demo (en vivo)",
    notes: "Abre el sitio en nueva pesta√±a y muestra la ruta corta.",
    content: (
      <div className={`${card} p-6 text-center`}>
        <Play className="w-12 h-12 text-sky-400 mx-auto"/>
        <p className="mt-2">Abrir demo del prototipo en producci√≥n</p>
        <a href={SITE_URL} target="_blank" rel="noreferrer" className={`${btn} mt-4 bg-sky-500/90 hover:bg-sky-500`}>Abrir EduConecta <ExternalLink className="w-4 h-4"/></a>
      </div>
    )
  },
  {
    title: "Validaci√≥n (piloto formativo)",
    notes: "Muestra m√©tricas y menciona que son exploratorias para orientar dise√±o.",
    content: (
      <div className={`${card} p-6 grid sm:grid-cols-3 gap-3 text-center`}>
        <div className="p-4 rounded-xl bg-white/5 border border-white/10"><p className="uppercase text-xs text-slate-400">Participantes</p><p className={theme.kpi}>{pilot.n}</p></div>
        <div className="p-4 rounded-xl bg-white/5 border border-white/10"><p className="uppercase text-xs text-slate-400">Recuerdo ayuda</p><p className={theme.kpi}>{Math.round(pilot.recall*100)}%</p></div>
        <div className="p-4 rounded-xl bg-white/5 border border-white/10"><p className="uppercase text-xs text-slate-400">Reutilizar</p><p className={theme.kpi}>{pilot.reuse}/5</p></div>
        <div className="p-4 rounded-xl bg-white/5 border border-white/10 sm:col-span-3"><p className="uppercase text-xs text-slate-400">Errores cr√≠ticos</p><p className={theme.kpi}>{pilot.errors}<span className="text-base"> / sesi√≥n</span></p></div>
      </div>
    )
  },
  {
    title: "Gobernanza de datos",
    notes: "Subraya sin PII por defecto; tablero agregado/anonimizado como etapa posterior.",
    content: (
      <div className={`${card} p-6`}>
        <ul className="space-y-2">
          <li className="flex items-center gap-2"><Shield className="text-emerald-400"/> Datos locales (navegador) y export JSON voluntario</li>
          <li className="flex items-center gap-2"><Shield className="text-emerald-400"/> Sin cuentas ni identificadores personales</li>
          <li className="flex items-center gap-2"><Shield className="text-emerald-400"/> Tablero institucional: <b>agregado/anonimizado</b>, con consentimiento</li>
        </ul>
      </div>
    )
  },
  {
    title: "Roadmap 12 semanas",
    notes: "Usabilidad ‚Üí Valor ‚Üí Integraci√≥n ‚Üí Escala piloto.",
    content: (
      <div className={`${card} p-6 grid sm:grid-cols-4 gap-3`}>
        <div className="p-4 rounded-xl bg-white/5 border border-white/10"><p className="font-bold">S1‚ÄìS2</p><p>Usabilidad & accesibilidad</p></div>
        <div className="p-4 rounded-xl bg-white/5 border border-white/10"><p className="font-bold">S3‚ÄìS6</p><p>+Asignaturas & tablero agregado</p></div>
        <div className="p-4 rounded-xl bg-white/5 border border-white/10"><p className="font-bold">S7‚ÄìS9</p><p>Conectar ayuda institucional</p></div>
        <div className="p-4 rounded-xl bg-white/5 border border-white/10"><p className="font-bold">S10‚ÄìS12</p><p>Piloto ampliado (SLEP)</p></div>
      </div>
    )
  },
  {
    title: "CTA: Piloto 12 semanas",
    notes: "Cierra con m√©tricas de √©xito y la acci√≥n a realizar.",
    content: (
      <div className={`${card} p-6 text-center`}>
        <p className={theme.p}>Criterios de √©xito: cumplir 3/4 ‚Üí Finalizaci√≥n ‚â•70% ‚Ä¢ Tiempo &lt;2‚Äô ‚Ä¢ Claridad ‚â•4/5 ‚Ä¢ Recuerdo ayuda ‚â•60%</p>
        <a href={SITE_URL} target="_blank" rel="noreferrer" className={`${btn} mt-4 bg-emerald-500/90 hover:bg-emerald-500`}><Rocket className="w-4 h-4"/> Agendar demo</a>
      </div>
    )
  }
];

// ======== DECK COMPONENT ========
const Deck = ({ audience }:{ audience: "usuarios"|"inversores" }) => {
  const slides = audience === "usuarios" ? userSlides : investorSlides;
  const [i, setI] = useState(0);
  const [presenter, setPresenter] = useState(false);

  const prev = useCallback(()=> setI(v => Math.max(0, v-1)), []);
  const next = useCallback(()=> setI(v => Math.min(slides.length-1, v+1)), [slides.length]);
  const goto = useCallback((n:number)=> setI(Math.min(Math.max(0,n), slides.length-1)), [slides.length]);

  useEffect(()=>{
    const onKey = (e: KeyboardEvent)=>{
      if(e.key === 'ArrowRight') next();
      if(e.key === 'ArrowLeft') prev();
    };
    window.addEventListener('keydown', onKey);
    return ()=> window.removeEventListener('keydown', onKey);
  }, [next, prev]);

  return (
    <div className={container}>
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center gap-2">
          {audience === "usuarios" ? <Users className="text-sky-400"/> : <Briefcase className="text-amber-400"/>}
          <h1 className={theme.h1}>
            {audience === "usuarios" ? "Presentaci√≥n ‚Äî Usuarios" : "Presentaci√≥n ‚Äî Inversores"}
          </h1>
        </div>
        <div className="flex items-center gap-2">
          <button className={`${btn} bg-white/10 hover:bg-white/20`} onClick={()=> setPresenter(v=>!v)}>
            {presenter ? "Ocultar notas" : "Notas del presentador"}
          </button>
        </div>
      </div>

      <div className="relative">
        <AnimatePresence mode="popLayout" initial={false}>
          <motion.div
            key={i}
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -20 }}
            transition={{ duration: .25 }}
            className={`${card} p-4 sm:p-6 md:p-8 min-h-[300px]`}
          >
            <div className="mb-4">
              <h2 className={theme.h2}>{i+1}. {slides[i].title}</h2>
            </div>
            <div>{slides[i].content}</div>
          </motion.div>
        </AnimatePresence>

        <div className="flex items-center justify-between mt-4">
          <button className={`${btn} bg-white/10 hover:bg-white/20`} onClick={prev} disabled={i===0}><ArrowLeft className="w-4 h-4"/> Anterior</button>
          <div className="flex items-center gap-1">
            {slides.map((_, idx)=> (
              <button key={idx} aria-label={`Ir a la diapositiva ${idx+1}`} onClick={()=> goto(idx)} className={`w-2.5 h-2.5 rounded-full ${idx===i ? 'bg-sky-400' : 'bg-white/20 hover:bg-white/40'}`}/>
            ))}
          </div>
          <button className={`${btn} bg-white/10 hover:bg-white/20`} onClick={next} disabled={i===slides.length-1}>Siguiente <ArrowRight className="w-4 h-4"/></button>
        </div>

        {presenter && (
          <div className="mt-4 p-4 rounded-xl bg-black/40 border border-white/10">
            <p className="text-slate-300 text-sm"><b>Notas:</b> {slides[i].notes}</p>
          </div>
        )}
      </div>

      <footer className="opacity-80 text-xs mt-6 text-slate-400 flex items-center gap-2">
        <LinkIcon className="w-3.5 h-3.5"/>
        <a href={SITE_URL} target="_blank" rel="noreferrer" className="hover:underline">{SITE_URL}</a>
        <span>‚Ä¢</span>
        <span>Usa ‚Üê ‚Üí para navegar</span>
      </footer>
    </div>
  );
};

// ======== ROOT APP ========
export default function App(){
  const [aud, setAud] = useState<"usuarios"|"inversores">("usuarios");
  return (
    <main className={theme.bg}>
      <header className={`${container} flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 pt-6 pb-2`}>
        <div className="flex items-center gap-3">
          <img alt="logo" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 24 24' fill='none' stroke='%2300b4d8' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2l3 7l7 2l-7 2l-3 7l-3-7l-7-2l7-2z'/%3E%3C/svg%3E" className="w-8 h-8"/>
          <div>
            <h1 className="text-xl sm:text-2xl font-extrabold tracking-tight">EduConecta ¬∑ Presentaciones</h1>
            <p className="text-slate-400 text-xs sm:text-sm">Interactivo ¬∑ Accesible ¬∑ Listo para demo</p>
          </div>
        </div>
        <div className="flex items-center gap-2">
          <button onClick={()=> setAud("usuarios")} className={`${btn} ${aud==='usuarios' ? 'bg-sky-500 hover:bg-sky-400' : 'bg-white/10 hover:bg-white/20'}`}><Users className="w-4 h-4"/> Usuarios</button>
          <button onClick={()=> setAud("inversores")} className={`${btn} ${aud==='inversores' ? 'bg-amber-500 hover:bg-amber-400' : 'bg-white/10 hover:bg-white/20'}`}><Briefcase className="w-4 h-4"/> Inversores</button>
        </div>
      </header>

      <Deck audience={aud}/>

      <div className="mt-8 pb-10 ${container}">
        <div className="text-center text-slate-400 text-xs">¬© 2025 EduConecta ‚Äî Prototipo acad√©mico</div>
      </div>
    </main>
  );
}
